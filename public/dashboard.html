<!doctype html>
<html>
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Dashboard</title>
  <style>
    :root{--accent:#25D366;--bg:#071016}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#fff}
    header{background:var(--accent);color:#002b14;padding:14px;text-align:center;font-weight:700}
    .wrap{max-width:1100px;margin:14px auto;padding:12px}
    .card{background:#071216;padding:12px;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}
    button{background:var(--accent);border:none;padding:8px;border-radius:8px;color:#002b14;cursor:pointer}
    .small{color:#97a5ad}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
  </style>
</head>
<body>
  <header>ðŸ“Š ChatSender â€” Admin Dashboard</header>
  <div class="wrap">
    <div class="card">
      <h3>Quick Actions</h3>
      <div style="display:flex;gap:8px">
        <a href="/admin-product.html"><button>Add Product / Job</button></a>
        <a href="/buyers.html"><button style="background:#fff;color:#111">Buyers</button></a>
        <a href="/admin-products.html"><button style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff">Products Admin</button></a>
      </div>
    </div>

    <div class="card">
      <h3>Recent Products</h3>
      <div id="recentProducts" class="small">Loading...</div>
    </div>

    <div class="card">
      <h3>Recent Orders</h3>
      <div id="recentOrders" class="small">Loading...</div>
    </div>

    <div class="card">
      <h3>Messages / Logs</h3>
      <div id="logs" class="small">Webhook & outbound logs stored in server/Firestore.</div>
    </div>
  </div>

<script>
  async function loadRecent(){
    try {
      const prodRes = await fetch('/api/admin/products?password=' + encodeURIComponent(prompt('Admin password to load products:')));
      const prodJ = await prodRes.json();
      if (prodJ && prodJ.success) {
        const list = prodJ.products.slice(0,6).map(p=>`<div><strong>${p.title||p.name}</strong> â€” ${p.category} â€” ${p.createdAt}</div>`).join('');
        document.getElementById('recentProducts').innerHTML = list || 'No products';
      } else {
        document.getElementById('recentProducts').innerText = 'Unauthorized or failed';
      }

      const ordRes = await fetch('/api/admin/orders?password=' + encodeURIComponent(prompt('Admin password to load orders:')));
      const ordJ = await ordRes.json();
      if (ordJ && ordJ.success) {
        const rows = ordJ.orders.slice(0,8).map(o=>`<div><strong>${o.productTitle}</strong> â€” ${o.name} â€” ${o.phone} â€” ${new Date(o.createdAt).toLocaleString()}</div>`).join('');
        document.getElementById('recentOrders').innerHTML = rows || 'No orders';
      } else {
        document.getElementById('recentOrders').innerText = 'Unauthorized or failed';
      }
    } catch (e) { console.error(e); }
  }
  loadRecent();
</script>
</body>
</html>
